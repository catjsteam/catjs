var _=require("underscore"),_fs=require("fs.extra"),_typedas=require("typedas"),_global=catrequire("cat.global"),_log=_global.log(),_props=catrequire("cat.props"),_os=require("os"),_globmatch=require("glob");module.exports=function(){var r=function(r){if(!_fs.existsSync(r))try{_fs.mkdirRecursiveSync(r),_log.debug("[copy action] target folder was created: "+r)}catch(e){throw _log.error("[copy action] failed to create target dir: "+r),e}},e=function(r,e,o){function t(r){if(!a){if(r)throw r;o&&o(r),a=!0}}var n,i,a=!1;return _fs.existsSync(r)?(n=_fs.createReadStream(r),n.on("error",function(r){t(r)}),i=_fs.createWriteStream(e),i.on("error",function(r){t(r)}),i.on("close",function(){t()}),void n.pipe(i)):void 0};return{isWindows:function(){var r=_os.platform();return"win32"===r.toLocaleLowerCase()?!0:!1},mkdirSync:r,copySync:e,globmatch:function(r){function e(r,e){var o=_globmatch.sync(r,e);return o||console.warn("[CAT libraries install] Failed match path: ",r," , skip"),o}var o,t,n=r.src,i="opt"in r?r.opt:{};if(n)if(_typedas.isArray(n))o=[],n.forEach(function(r){var t;if(r)try{t=e(r,i),t&&t.length>0?o=o.concat(t):o.push(r)}catch(n){console.warn("[CAT libraries install] Failed to resolve path: ",r,"with errors: ",n),o.push(r)}});else if(_typedas.isString(n))try{t=e(n,i),o=t&&t.length>0?t:[n]}catch(a){console.warn(" Failed to resolve path: ",n,"with errors: ",a),o=n}return o},deleteSync:function(r){if(r&&_fs.existsSync(r))try{_fs.rmrfSync(r)}catch(e){this.error(_props.get("cat.error").format("[utils (deleteSync)]",e))}},log:function(r,e){r&&_log[r]&&_log[r](e),"info"===r?r="log":"warning"===r&&(r="warn"),console[r]?console[r](e):console.log("Console has no support for function: '"+r+"'")},error:function(r){throw _log.error(r),console&&console.error(r),r},getRelativePath:function(r,e){return r&&e?r.substring(e.length):void 0},resolveObject:function(r,e){if(!r||!e)return r;for(var o,t=e.split("."),n=t.length,i=0;n>i;){if(o=t[i],!o||!r[o])return i=n,_log.warning(_props.get("cat.utils.resolver.warn").format("[utils resolver]",e)),null;r=r[o],i++}return r},prepareCode:function(r){for(var e,o,t=r?r.length:0,n=0;t>n;n++)e=r[n],e&&(o=e.trim(),o.indexOf(";")!==o.length-1&&(r[n]+=";"));return r},contains:function(r,e){var o;if(r)for(o in r)if(r[o]===e)return!0;return!1},removeArrayItemByIdx:function(r,e){var o=[],t=0;return r&&_typedas.isArray(r)&&r.forEach(function(r){e!==t&&o.push(r),t++}),o},removeArrayItemByValue:function(r,e){var o=[],t=0;return r&&_typedas.isArray(r)&&r.forEach(function(r){r!==e&&null!==r&&void 0!==r&&o.push(r),t++}),o},cleanupArray:function(r){var e=[];return r&&_typedas.isArray(r)&&r.forEach(function(r){null!==r&&void 0!==r&&e.push(r)}),e},copyObjProps:function(r,e,o){var t,n,i,a=this,c=0,s=0;if(o=o||!1,r&&e)for(t in r)if(r.hasOwnProperty(t))if(n=e[t],_typedas.isObject(r[t]))e[t]||(e[t]={}),arguments.callee.call(a,r[t],e[t],o);else if(_typedas.isArray(r[t]))if(n)if(_typedas.isArray(n))if(a.cleanupArray(r[t]),o)e[t]=r[t];else{for(s=e[t].length,c=0;s>c;c++)i=n[c],r[t]=a.removeArrayItemByValue(r[t],i);e[t]=e[t].concat(r[t])}else _log.warning(_props.get("cat.utils.copy.object.array.warn").format("[utils copy object]",t,typeof n));else e[t]=r[t];else(o||void 0===n)&&(!e[t]||e[t]&&o)&&(e[t]=r[t])},forEachProp:function(r,e){var o;if(r)for(o in r)r.hasOwnProperty(o)&&e&&e.call(r,o)},kill:function(r,e){function o(r,e){if(r!==e)try{_log.error("[kill process] sending SIGKILL signal to pid: "+r),o.kill(r,"SIGKILL")}catch(t){_log.error("[kill process] failed to kill pid: "+r+"; The process might not exists")}}r&&r.forEach(function(r){e?e.forEach(function(e){o(r,e)}):o(r)})}}}();