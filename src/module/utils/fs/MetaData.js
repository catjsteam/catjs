var _fs=require("fs"),_path=require("path"),_beautify=require("js-beautify").js_beautify,_global=catrequire("cat.global"),_log=_global.log(),_utils=catrequire("cat.utils"),_props=catrequire("cat.props");module.exports=function(){var t,e=_global.get("home").working.path,a="_cat_md.json",r=function(){return t||(t=_path.normalize([e,a].join("/"))),t},i=function(t){var e=this;this.files={},this.project={basepath:void 0,resources:[]},this.update=function(t,a){t.files&&_utils.copyObjProps(t.files,e.files,a),t.project&&_utils.copyObjProps(t.project,e.project,a)},t&&this.update(t)};return{normalize:function(t){var e,a,r,i,s=this.exists()?this.read():void 0;if(!s)return void 0;if(s=JSON.parse(s),t&&s){if(t.files&&s.files)for(e in t.files)if(a=s.files[e])for(r in a)t.files[e]&&(i=t.files[e][r],"undefined"==typeof i&&delete s.files[e][r]);this.update(s,!0)}},update:function(t,e){var a,r,s;e?s=t:(a=this.exists()?this.read():void 0,a?(r=JSON.parse(a),a=new i(r),a.update(t,!0)):a=new i(t),s=a),this.write(JSON.stringify(s))},exists:function(){return _fs.existsSync(r())},write:function(t){try{_fs.writeFileSync(r(),_beautify(t,{indent_size:2})),_log.debug(_props.get("cat.mdata.write").format("[cat mdata]"))}catch(e){_utils.error(_props.get("cat.error").format("[cat mdata]",e))}},read:function(){var t;try{_fs.existsSync(r())?(t=_fs.readFileSync(r(),"utf8"),_log.debug(_props.get("cat.mdata.read").format("[cat mdata]"))):_log.warning(_props.get("cat.mdata.file.not.exists").format("[cat mdata]"))}catch(e){_utils.error(_props.get("cat.error").format("[cat mdata]",e))}return t},readAsync:function(t){_fs.existsSync(r())?_fs.readFile(r(),function(e,a){e?_utils.error(_props.get("cat.error").format("[cat mdata]",e)):(_log.debug(_props.get("cat.mdata.read").format("[cat mdata]")),t.call({data:a}))}):_log.warning(_props.get("cat.mdata.file.not.exists").format("[cat mdata]"))}}}();