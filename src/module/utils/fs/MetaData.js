var _fs=require("fs"),_path=require("path"),_beautify=require("js-beautify").js_beautify,_global=catrequire("cat.global"),_log=_global.log(),_utils=catrequire("cat.utils"),_props=catrequire("cat.props");module.exports=function(){var t,e=_global.get("home").working.path,r="_cat_md.json",i=function(){return t||(t=_path.normalize([e,r].join("/"))),t},a=function(t){var e=this;this.files={},this.project={basepath:void 0,resources:[]},this.update=function(t,r){t.files&&_utils.copyObjProps(t.files,e.files,r),t.project&&_utils.copyObjProps(t.project,e.project,r)},t&&this.update(t)};return{normalize:function(t){var e,r,i,a,s=this.exists()?this.read():void 0;if(!s)return void 0;if(s=JSON.parse(s),t&&s){if(t.files&&s.files)for(e in t.files)if(r=s.files[e])for(i in r)t.files[e]&&(a=t.files[e][i],"undefined"==typeof a&&delete s.files[e][i]);this.update(s,!0)}},update:function(t,e){var r,i,s;e?s=t:(r=this.exists()?this.read():void 0,r?(i=JSON.parse(r),r=new a(i),r.update(t,!0)):r=new a(t),s=r),this.write(JSON.stringify(s))},exists:function(){return _fs.existsSync(i())},write:function(t){try{_fs.writeFileSync(i(),_beautify(t,{indent_size:2}))}catch(e){_utils.error(_props.get("cat.error").format("[cat mdata]",e))}},read:function(){var t;try{_fs.existsSync(i())?t=_fs.readFileSync(i(),"utf8"):_log.warning(_props.get("cat.mdata.file.not.exists").format("[cat mdata]"))}catch(e){_utils.error(_props.get("cat.error").format("[cat mdata]",e))}return t},readAsync:function(t){_fs.existsSync(i())?_fs.readFile(i(),function(e,r){e?_utils.error(_props.get("cat.error").format("[cat mdata]",e)):(_log.debug(_props.get("cat.mdata.read").format("[cat mdata]")),t.call({data:r}))}):_log.warning(_props.get("cat.mdata.file.not.exists").format("[cat mdata]"))}}}();