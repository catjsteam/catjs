var _global=catrequire("cat.global"),_utils=catrequire("cat.utils"),_log=_global.log(),_path=require("path"),_fsconfig=catrequire("cat.config.utils"),_typedas=require("typedas"),_props=catrequire("cat.props"),_watch=catrequire("cat.watch"),_catconfig,_loadCATConfig,_CATConfig=function(t,e){function n(e){e&&e.name&&(e.getPhase=function(){return e.phase||"default"},c._extmap[e.name]={externalConfig:t,ext:e,ref:null})}var o,i,a,r,s,p,c=this,f=0,g=[],h=[];if(this._extmap={},this._watch={},this.extensions=e.extensions,this.plugins=e.plugins,this.externalConfig=t,this.extensions){if(_typedas.isArray(this.extensions))for(o=this.extensions.length;o>f;f++)n(this.extensions[f]);this.env=e.env,this.externalConfig&&(i=this.externalConfig.project,i?(e&&e.extensions&&(e.extensions.forEach(function(t){t&&t.name&&h.push({name:t.name,type:t.name})}),i.appendEntity("dependencies",h)),i.setInfo("template",this.env.template),i.setInfo("libraries",this.env.libraries),this.plugins.forEach(function(t){g.push(_path.join(cathome,t))}),i.addPluginLocations(g),p=[],a=_path.join("./",_path.relative(_path.resolve("."),i.getInfo("target")),i.name),r=i.getInfo("apppath"),r&&(s={name:"p@project.copy",type:"copy",dependency:"scan",path:r,from:{path:"/"},to:{path:a}},p.push(s)),p=p.concat([{name:"p@lib.copy",type:"copy",dependency:"scan",path:"./lib",from:{path:"/"},to:{path:a}},{name:"p@project.minify",type:"minify",path:a,filename:"cat.src.js",src:["./src/**/*.js"]}]),i.appendEntity("plugins",p)):_log.warning(_props.get("cat.project.env.failed").format("[CAT Config Loader]")))}};_CATConfig.prototype.watch=function(t){this._watch.impl=t.impl},_CATConfig.prototype.getWatch=function(){return this._watch.impl},_CATConfig.prototype.isWatch=function(){return this._watch.impl?!0:!1},_CATConfig.prototype.getExtension=function(t){return t&&this._extmap?this._extmap[t]:void 0},_CATConfig.prototype.getProject=function(){return this.externalConfig?this.externalConfig.project:void 0},_CATConfig.prototype.getGrunt=function(){return this.externalConfig?this.externalConfig.grunt:void 0},_CATConfig.prototype.getEmitter=function(){return this.externalConfig?this.externalConfig.emitter:void 0},_loadCATConfig=function(t,e){try{new _fsconfig(e,function(e){e?_catconfig=new _CATConfig(t,e):_log.error(_props.get("cat.error.config").format("[CAT Config Loader]"))})}catch(n){_log.error(_props.get("cat.error.config").format("[CAT Config Loader]"),n)}return _catconfig},module.exports=function(){return{load:function(t){var e=[cathome,"resources/cat.json"].join("/");return _loadCATConfig(t,e)}}}();