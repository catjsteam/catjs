var _log=catrequire("cat.global").log(),_typedas=require("typedas"),_Filter=require("./Filter.js");module.exports=function(t){function e(){n=t.data,a=t.emitter,o=t.global,r=t.catconfig}var i,n,a,o,r,l=this;return this.filters=[],t&&(e(),n?(this.name=n.name,this.type=n.type,this.to=n.to,this.from=n.from,this.dependency=n.dependency,this.data=n,this.apply=function(t){var e=l.type||l.name,i=t.internalConfig,n=!0;if(l.dependencyTarget=t.dependency,_log.info("[CAT] running target: "+e),e){_log.debug("[Action] Instantiating action: "+e);try{l.ref=r.pluginLookup(e),l.ref&&(l.action=new l.ref,l.ref.validate&&(n=l.ref.validate(l,t),n||_log.warning("[CAT Action] plugin validation failed, the plugin might not function as expected "))),l.action&&l.action.init({data:l,emitter:a,global:o,internalConfig:i})}catch(c){_log.error("[CAT Action] action type not found or failed to load module ",c)}}return l},i=n.filters||void 0,i&&i.forEach(function(t){t&&l.filters.push(new _Filter(t))})):_log.warning("[CAT Action] No valid data configuration")),this};