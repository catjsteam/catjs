var _childProcess=require("child_process"),_path=require("path"),_phantomjs=require("phantomjs"),_binPath=_phantomjs.path,_global=catrequire("cat.global"),_utils=catrequire("cat.utils"),_props=catrequire("cat.props"),_log=_global.log();module.exports=function(){return{run:function(t,o){var e,r=[],a=0,s={};if(!t)return void 0;if(t.file&&(r.push(t.file),a++,s.cwd=_path.dirname(t.file)),t.host&&(r.push(t.host),a++),2===a)try{e=_childProcess.spawn(_binPath,r,s),e.stdout.setEncoding("utf8"),e.stdout.on("data",function(t){var o=new Buffer(t);_log.debug(_props.get("cat.ext.spawn.phantomjs.log").format("[phantomjs bridge]","info",o.toString("utf8")))}),e.stderr.on("data",function(t){t+="",_log.debug(_props.get("cat.ext.spawn.phantomjs.log").format("[phantomjs bridge]","error",t.replace("\n","\nstderr: ")))}),e.on("exit",function(t){console.log("child process exited with code "+t),_log.debug(_props.get("cat.ext.spawn.phantomjs.log").format("[phantomjs bridge]","exit","child process exited with code "+t)),process.exit(t),o&&o.call(this)})}catch(i){_log.debug(_props.get("cat.error").format("[phantomjs bridge]",i))}}}}();