function readConfig(){var e,t,r,a,s,o,i=require("path"),n={};if(_catcli)if(s=_catcli.getProject())try{o=s.getInfo("source"),e=i.join(o,"/config/cat.json")}catch(l){_log.error("[CAT server (assert module)] Failed to load cat.json test project, No CAT test project is available.",l)}else _log.error("[CAT server (assert module)] Failed to load cat.json test project, No CAT project is available.");for(t=_fs.readFileSync(e,"utf8"),r=JSON.parse(t),a=0;a<r.tests.length;a++)r.tests[a].wasRun=!1,n[r.tests[a].name]=r.tests[a];return n}function ReportCreator(e){this._fileName=e}var _jmr=require("test-model-reporter"),_global=catrequire("cat.global"),_log=_global.log(),_reportCreator,_testsuite=_jmr.create({type:"model.testsuite",data:{name:"testsuite"}}),_catcli=catrequire?catrequire("cat.cli"):null,_fs=require("fs"),_testConfigMap,_isAlive=!1,_checkIfAlive;_testConfigMap=readConfig(),ReportCreator.prototype.addTestCase=function(e,t,r,a){var s,o;s=_jmr.create({type:"model.testcase",data:{time:(new Date).toUTCString()}}),s.set("name",r+e),"failure"===t&&(o=_jmr.create({type:"model.failure",data:{message:a,type:t}}),s.add(o)),_testConfigMap[e]?_testConfigMap[e].wasRun=!0:_log.info("Test "+e+" not in test manager"),_testsuite.add(s);var i=_testsuite.compile(),n="failure"===t?"✖":"✓",l="failure"===t?"failed":"passed";console.log(n+"Test "+e+" "+a+" "+l),_fs.existsSync(this._fileName)&&_fs.unlinkSync(this._fileName),_jmr.write(this._fileName,i)},_checkIfAlive=setInterval(function(){if(!_isAlive){clearInterval(_checkIfAlive),_log.info("Tests stopped reporting, probably a network problem, failing the rest of the tests"),_reportCreator||(_reportCreator=new ReportCreator("notestname.xml"));for(var e in _testConfigMap)_log.info(_testConfigMap[e]),_testConfigMap[e].wasRun||_reportCreator.addTestCase(_testConfigMap[e].name,"failure","unknown","failed due to network issue")}},3e4),void 0===_jmr&&_log.info("Test Unit Reporter is not supported, consider adding it to the .catproject dependencies"),exports.result=function(e,t){var r,a=e.query.testName,s=e.query.message,o=e.query.status,i=e.query.type,n=e.query.hasPhantom;_isAlive=!0,_log.info("requesting "+a+s+o),t.setHeader("Content-Type","text/javascript;charset=UTF-8"),t.send({testName:a,message:s,status:o});var l="true"===n?"phantom":"";r="./cattestresult"+i+"-"+l+".xml",_reportCreator||(_reportCreator=new ReportCreator(r)),_reportCreator.addTestCase(a,o,l,s)};