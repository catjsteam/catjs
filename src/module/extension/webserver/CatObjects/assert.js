function readConfig(){var e,t,r,s=require("path"),a=s.resolve("./lib/cat.json"),o={};for(e=_fs.readFileSync(a,"utf8"),t=JSON.parse(e),r=0;r<t.tests.length;r++)t.tests[r].wasRun=!1,o[t.tests[r].name]=t.tests[r];return o}function ReportCreator(e){var t=e;this.addTestCase=function(e,r,s,a){var o,n;o=_jmr.create({type:"model.testcase",data:{time:(new Date).toUTCString()}}),o.set("name",s+e),"failure"===r&&(n=_jmr.create({type:"model.failure",data:{message:a,type:r}}),o.add(n)),_testConfigMap[e]?_testConfigMap[e].wasRun=!0:console.log("Test "+e+" not in test manager"),_testsuite.add(o);var i=_testsuite.compile();console.log(i),_fs.existsSync(t)&&_fs.unlinkSync(t),_jmr.write(t,i)}}var _jmr=require("test-model-reporter"),_reportCreator,_testsuite=_jmr.create({type:"model.testsuite",data:{name:"testsuite"}}),_fs=require("fs"),_testConfigMap,_isAlive=!1,_checkIfAlive;_testConfigMap=readConfig(),_checkIfAlive=setInterval(function(){if(!_isAlive){clearInterval(_checkIfAlive),console.log("Tests stopped reporting, probably a network problem, failing the rest of the tests"),_reportCreator||(_reportCreator=new ReportCreator("notestname.xml"));for(var e in _testConfigMap)console.log(_testConfigMap[e]),_testConfigMap[e].wasRun||_reportCreator.addTestCase(_testConfigMap[e].name,"failure","unknown","failed due to network issue")}},3e4),void 0===_jmr&&console.log("Test Unit Reporter is not supported, consider adding it to the .catproject dependencies"),exports.result=function(e,t){var r,s=e.query.testName,a=e.query.message,o=e.query.status,n=e.query.type,i=e.query.hasPhantom;_isAlive=!0,console.log("requesting "+s+a+o),t.setHeader("Content-Type","text/javascript;charset=UTF-8"),t.send({testName:s,message:a,status:o});var l="true"===i?"phantom":"";r="./cattestresult"+n+"-"+l+".xml",_reportCreator||(_reportCreator=new ReportCreator(r)),_reportCreator.addTestCase(s,o,l,a)};