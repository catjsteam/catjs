var _http=require("http"),_url=require("url"),_path=require("path"),_fs=require("fs"),_express=require("express"),_global=catrequire("cat.global"),_log=_global.log(),_props=catrequire("cat.props"),_server,_utils=catrequire("cat.utils"),vars={assert:require("./CatObjects/assert")};module.exports=function(){return{start:function(e,r){var s=e.path,t=e.port||"80",o=e.set,a=function(e,r,s){r.header("Access-Control-Allow-Origin",e.headers.origin),r.header("Access-Control-Allow-Methods","GET,PUT,POST,DELETE,OPTIONS"),s()};return!s||s&&!_fs.existsSync(s)?void _utils.log("warning","[CAT WebServer] not valid location: "+s):(_server=_express(),_server.configure(function(){_server.set("port",process.env.PORT||t),_server.use(_express.logger("dev")),_server.use(_express.bodyParser()),_server.use(a),_server.use(_express.bodyParser()),_server.use(_express.static(s))}),o&&o.forEach(function(e){var r;e&&"var"in e&&(r=vars[e.var],void 0!==r&&"prop"in e&&(r=r[e.prop],_server.get("/"+e.key,r)))}),_server.get("/exit",function(e,r){r.setHeader("Content-Type","text/javascript;charset=UTF-8"),r.send('{"exit": 1}'),process.exit(1)}),void _server.listen(t,function(){_log.info(_props.get("cat.ext.webserver.start").format("[webserver ext]")),r&&r.call(this)}))},stop:function(e){_server&&(_log.debug(_props.get("cat.ext.webserver.stop").format("[webserver ext]")),e&&e.call(this),_server.close(function(){}))}}}();