var _catglobal=catrequire("cat.global"),_log=_catglobal.log(),_path=require("path"),_props=catrequire("cat.props"),_basePlugin=catrequire("cat.plugin.base"),_utils=catrequire("cat.utils"),_fs=require("fs.extra"),_typedas=require("typedas"),_jsutils=require("js.utils"),_glob=require("glob"),_minimatch=require("minimatch");module.exports=_basePlugin.ext(function(){function e(e){var i,a,t,r=e.mode,n=e.path,o=e.name,s=e.jshint,l=e.excludes,c=e.src,u=[],d=0,p=0;if(!c||!n||!o)return void _log.error("[CAT minify plugin] src, name, path are required properties ");try{if(i=_jsutils.Task[r]){if(l){for(p=l.length,d=0;p>d;d++)if(a=l[d])if(_typedas.isArray(c))t=0,c.forEach(function(e){_minimatch(e,a,{matchBase:!0})&&u.push(t),t++});else if(!_typedas.isArray(c)&&_minimatch(c,a,{matchBase:!0}))return void 0;_typedas.isArray(c)&&u.length>0&&u.forEach(function(e){c=c.splice(e,1)})}i({src:c,out:{name:o,path:n},jshint:s||{opt:{evil:!0,strict:!1,curly:!0,eqeqeq:!0,immed:!1,latedef:!0,newcap:!1,noarg:!0,sub:!0,undef:!0,boss:!0,eqnull:!0,node:!0,es5:!1},globals:{XMLHttpRequest:!0,document:!0,_cat:!0,chai:!0}}})}}catch(h){_log.error("[CAT minify plugin] failed with errors, file:",c),_log.error("[CAT minify plugin] failed with errors: ",h)}}var i,a,t,r,n,o=this;return{init:function(s){var l,c,u,d,p,h,m,f,_=[],g=["[libraries plugin] No valid configuration"];s||(_log.error(g[1]),o.setDisabled(!0)),i=s.emitter,a=s.global,t=s.data,r=s.internalConfig,n=r?r.getProject():void 0,o.dataInit(t),f=t.data,s&&f&&(l="src"in f?f.src:void 0,p="jshint"in f?f.jshint:void 0,u="filename"in f?f.filename:void 0,c=("path"in f?f.path:void 0)||".",d=("mode"in f?f.mode:void 0)||"dev",m="excludes"in f?f.excludes:void 0,h=("isolate"in f?"true"===f.isolate?!0:!1:void 0)||!1,l?h?(l.forEach(function(e){_=_.concat(_glob.sync(e))}),_.forEach(function(i){var a=_path.basename(i);-1===a.indexOf(".catmin")&&(u=_path.basename(i,_path.extname(i))+_path.extname(i)),e({src:i,name:u,path:_path.dirname(i),mode:d,excludes:m,jshint:p})})):e({src:l,name:u,path:c,mode:d,excludes:m,jshint:p}):_log.error("[CAT clean plugin] 'src' property is required "),i.emit("job.done",{status:"done"}))},validate:function(){return{dependencies:["manager"]}}}});