var _catglobal=catrequire("cat.global"),_log=_catglobal.log(),_path=require("path"),_props=catrequire("cat.props"),_basePlugin=catrequire("cat.plugin.base"),_utils=catrequire("cat.utils");module.exports=_basePlugin.ext(function(){var e,n,t,a=this,i={exec:function(e){var n,a,o,r,s=t.data;e&&s&&(n=e.spawn,a=s.command,o=s.options,r=s.args,i.spawn({spawn:n,command:a,options:o,args:r,inline:!0}))},spawn:function(n){if(!n)return void 0;var t,a,o=n.command,r=n.args,s=n.options,c=n.spawn||require("child_process").spawn,l=n.inline,p=e||n.emitter;try{s||(s={cwd:_catglobal.get("home").working.path}),_utils.isWindows()&&(r.unshift("/c",o),o="cmd"),t=c(o,r,s),t.stdout.on("data",function(e){_log.info("[spawn info] "+e)}),t.stderr.on("data",function(e){_log.info("[spawn info] "+e)}),a=function(e){0!==e&&_log.info("[spawn close] exited with code "+e),p&&l&&p.emit("job.done",{status:"done"}),p.removeListener("spawn.exec",i.exec)},t.on("close",a)}catch(u){_utils.error(_props.get("cat.error").format("[spawn]",u)),p&&p.emit("job.done",{status:"done"})}return t},getListeners:function(n){return a.isDisabled()?void 0:e.listeners(n)},init:function(o){var r=["[spawn plugin] spawn operation disabled, No valid configuration"];o||(_log.error(r[1]),a.setDisabled(!0)),e=o.emitter,n=o.global,t=o.data,a.dataInit(t),e?(e.removeListener("spawn.exec",i.exec),e.on("spawn.exec",i.exec)):_log.warning("[Scrap plugin] No valid emitter, failed to assign listeners")},validate:function(){return{dependencies:["spawn"]}}};return i});