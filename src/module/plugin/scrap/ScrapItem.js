function _validateConfigEntry(t,n){var i,e={};"singleton"===t&&(i=n[t],i&&2===i&&(n[t]=1)),"$type"===t&&(i=n[t],i&&(_scrapEnum.scrapEnum.fileTypes.forEach(function(n){n===(_typedas.isArray(i)?i[0]:i)&&(e[t]=!0)}),e[t]||_utils.error(_props.get("cat.error.scrap.file.type.not.supported").format("[scrap item]",i))))}function _cleanObjectNoise(t){function n(t){return t?(t=-1!==t.indexOf("\r")?t.split("\r").join(""):t,t=-1!==t.indexOf("\n")?t.split("\n").join(""):t,t=-1!==t.indexOf("	")?t.split("	").join("    "):t):t}var i,e,r=0,o=0;if(t){if(_typedas.isString(t))return n(t);if(_typedas.isArray(t)){for(o=t.length,r=0;o>r;r++)i=t[r],i&&(_ScrapConfigItem.instanceOf(i)?(i=_ScrapConfigItem.create(i.config),e=i.getValue()):e=i,t[r]=n(e));return t}}return t}var _utils=catrequire("cat.utils"),_props=catrequire("cat.props"),_typedas=require("typedas"),_log=catrequire("cat.global").log(),_scrapEnum=require("./ScrapEnum.js"),_ScrapConfigItem=require("./ScrapConfigItem.js"),_ScrapContext=require("./Context.js"),_scraputils=catrequire("cat.scrap.utils"),_jsutils=require("js.utils"),__id=0,_scrapId=function(){return __id++,["scrap",__id].join("_")},_clazz;_clazz=function(t){function n(t,n){void 0===e.config[t]&&e.set(t,n)}function i(t){var n,i=e.config[t];return i&&(i=_cleanObjectNoise(i),void 0!==i&&null!==i&&(e.isSingle(t)||_utils.contains(_scrapEnum.scrapEnum.singleTypes,t))&&_typedas.isArray(i))?(_utils.cleanupArray(i),n=i.length,i[n-1]):i}var e=this;t||_utils.error(_props.get("cat.error.config").format("[scrap class]")),this.config=t,this.output=[],this.arguments=[],this.$$context=new _ScrapContext,this.getEnum=_scrapEnum.getScrapEnum,this.set=function(n,i){n&&(t[n]=i,this[n]=function(){return this.config[n]})},function(){n("single",{}),n("singleton",{}),n("arguments",[]),n("id",_scrapId()),n("$type",_scrapEnum.scrapEnum.defaultFileType),e.config&&_utils.forEachProp(e.config,function(t){var n,r={};t&&(e.config.single[t]=!0,e.config.singleton[t]=-1,n=e[t+"Init"],n&&n.call(e),r=_validateConfigEntry(t,e.config),e[t]=function(){return i(t)})})}()},_clazz.prototype.isSingle=function(t){return this.config.single[t]},_clazz.prototype.addConfig=function(t,n){t&&_typedas.isArray(t)?t.forEach(function(t){t&&t.key&&"undefined"!=typeof t.value?this.config[n][t.key]=t.value:_log.warning(_props.get("cat.scrap.single.properties").format("[scrap class (addSingle)]"))}):_log.warning(_props.get("cat.arguments.type").format("[scrap class (addSingle)]","array"))},_clazz.prototype.addSingleton=function(t){this.addConfig(t,"singleton")},_clazz.prototype.setSingleton=function(t,n){this.config.singleton[t]=n},_clazz.prototype.getRunat=function(){return this.config["run@"]},_clazz.prototype.getSingleton=function(t){return this.config.singleton[t]},_clazz.prototype.addSingle=function(t){this.addConfig(t,"single")},_clazz.prototype.setSingle=function(t,n){return this.config.single[t]=n},_clazz.prototype.$getType=function(){return this.config.$type},_clazz.prototype.$getBehavior=function(){return this.config.$behavior},_clazz.prototype.$getEngine=function(){var t=this.config.$type;if("js"===t)return _scrapEnum.scrapEnum.engines.JS;if("html"===t){if(this.get("import"))return _scrapEnum.scrapEnum.engines.HTML_IMPORT_JS;if(this.get("embed"))return _scrapEnum.scrapEnum.engines.HTML_EMBED_JS}else if("*"===t&&this.get("inject"))return _scrapEnum.scrapEnum.engines.HTML_EMBED_INSERT},_clazz.prototype.$setType=function(t){_validateConfigEntry(t,this.config);this.config.$type=t},_clazz.prototype.$setBehavior=function(t){this.config.$behavior=t},_clazz.prototype.get=function(t){var n;return t&&this[t]&&(n=this[t]()),n},_clazz.prototype.setCtxArguments=function(t){t&&(_typedas.isArray(t)?(this.config.arguments=[],this.config.arguments=this.config.arguments.concat(t),this.set("arguments",_cleanObjectNoise(this.config.arguments))):_log.warning(_props.get("cat.arguments.type").format("[scrap class (addCtxArguments)]","array")))},_clazz.prototype.generateCtxArguments=function(){var t=this.get("arguments");return t&&t.join?t.join(", "):""},_clazz.prototype.generate=function(){return this.output?this.output.join(" \n "):""},_clazz.prototype.print=function(t){t&&(_typedas.isArray(t)?this.output=this.output.concat(t):this.output.push(t))},_clazz.prototype.apply=function(){var t,n=this;_utils.forEachProp(this.config,function(i){var e;i&&(e=n[i+"Apply"],e&&(t=n.getSingleton(i),2>t&&e.call(n,{}),1===t&&n.setSingleton(i,t++)))})},_clazz.prototype.serialize=function(){var t={};return _utils.forEachProp(this.config,function(n){n&&(t[n]=this[n])}),t},_clazz.prototype.update=function(t,n){var i=this.config[t];i||(this.config[t]=this.getEnum(t)),_utils.copyObjProps(this.config[t],n)},_clazz.prototype.getContextItem=function(t){return this.$$context.get(t)},_clazz.prototype.buildContext=function(t){var n=this;this.$$context.destroy(),t.forEach(function(t){var i=n.get(t);void 0!==i&&n.$$context.set(t,n.get(t))})},_clazz.prototype.extractAnnotations=function(t){var n={};return t.forEach(function(t){var i,e,r;t&&(i=_scraputils.extractSingle(t),i&&(e=i.key.trim(),r=i.value.trim(),n[e]=r))}),n},_clazz.prototype.$setReplaceData=function(t){function n(){o=t?t.action||"comment":"comment"}var i,e,r,o,s,a=this.get("commentinfo"),c=this.get("replace"),p=[],u=0,l=0;if(a&&(r=a.end?a.end.line:void 0,r&&c&&c[0]&&(n(),c=c.split(":")))){if(i=c[0]?c[0].trim():void 0,e=c[1]?c[1].trim():void 0,i&&void 0!==e&&"after"===i)for(u=r+1,l=u+Number(e);l>u;u++)p.push(u);p.length>0&&(s={lines:[],$linesmap:{},rows:p,action:o||void 0,$ready:0,newlines:[],apply:function(t){var n,i,e,r=this,s=0,a=0;if(o&&t){if(_jsutils.Object.contains(this.rows,t.row)&&(this.lines.push(t.line),this.rows.indexOf(t.row)===this.rows.length-1)){if(this.newlines=o.call({},this.lines,t.mark),this.newlines&&_typedas.isArray(this.newlines)){if(this.newlines.forEach(function(t){r.$linesmap[r.rows[s]]=t,s++}),i=this.rows.length-this.newlines.length,0!==i)for(a=s;i>a;a++)r.$linesmap[r.rows[a]]="\r\n"}else _log.warning("[CAT ScrapItem] While invoking 'replace' implementation: '"+o+"', No valid return value of type Array was found");this.$ready=1}1===this.$ready&&(n=t.row-1,n===t.lines.length&&(e=this.$linesmap[n],(e||null===e)&&(t.lines[n-1]=(e||"")+(e&&-1===e.indexOf("\n")?"\n":""))))}}},this.set("replaceinfo",s))}},module.exports=_clazz;